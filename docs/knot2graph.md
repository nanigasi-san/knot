# 結び目のグラフとしての表現(step3まで)

## 目次
1. 概要
2. グラフとしての特徴
3. 結び目→グラフ
4. グラフ→結び目
5. 同一性の判定
6. 資料

## 1. 概要
一本のひもにRI+/S+をすることで構成された結び目を多重有向グラフ(多重辺や自己ループを持つ有向グラフ)として表現する。


交点の連なりを頂点としてみると、頂点aから頂点bへ伸びる部分は辺(a, b)とみなすことができる。

## 2. グラフとしての特徴と制約
### グラフとしての特徴
結び目を有向グラフで表現したもの(以下、結び目グラフ、あるいは単にグラフと表記する。)の特徴をまとめる。

#### オイラーグラフである
結び目の特性として、ある点を始点としてひもをたどった時に、かならず結び目の全ての部分を一回ずつ通って始点に戻る。これをグラフの性質として言い換えると、**全ての辺を一回ずつ使って最初の点に戻る経路** が存在するといえ、この経路のことを **オイラー閉路** といい、オイラー閉路が存在するグラフを **オイラーグラフ** という。つまり、結び目グラフはオイラーグラフである。

#### 各頂点の次数は偶数
オイラーグラフの特徴として、全ての頂点の入次数と出次数が等しいということがある。結び目グラフはオイラーグラフであるため、この特徴を持つ。また、入次数=出次数の性質から次数が偶数であることも保証される。

### 制約
ただのオイラーグラフとは違い、いくつか制約が存在する。

#### 入力辺に対応する出力辺が一つだけ存在する
結び目はただ一通りのオイラー閉路を持つため、`(a, X), (b, X), (X, c), (X, d)`のような4辺が存在した場合、

1. `(a, X)(X, c)...(b, X), (X, d)...`
2. `(a, X)(X, d)...(b, X), (X, c)...`

のどちらか一つの繋がり方しかできない。つまり、ある(a, X)に対してその次に通らなければならない(X, b)がただ一つ存在する。

#### 一つの頂点の最大次数は4
+ Odd, Evenの頂点は次数4になる。
+ 空頂点は辺の途中に生成されるので次数2であるが、空頂点が自己ループを持った時、自己ループを持つOdd頂点と見做し、次数が4になる。(このような頂点はグラフを整理するときに消える。)

## 3. 結び目→グラフ
結び目を結び目グラフに変換する手法について書く。

この時、ある向きを持った結び目Kiに対してグラフGiがただ一つ定まるように定義する。

### データ構造
各頂点の軸に対して、片側をA、もう片側をBとする。

#### 頂点
`(頂点番号, 偶奇)`の形式で表す。
頂点の偶奇によって辺の出方が違う。
|種類|説明|性質|
|:-|:-|:-|
|None|空頂点|入次数=出次数=1の場合消去できる。|
|Odd|奇数個の交点を持つ頂点|A(B)に入ったらB(A)から出る。|
|Even|偶数個の交点を持つ頂点|A(B)に入ったらA(B)から出る。|

#### 辺
`(u, v, Tu, Tv)`の形式であらわす。
|属性|説明|値|
|:-|:-|:-|
|u|辺の始点|int|
|v|辺の終点|int|
|Tu|辺がuのどこから生えているか|`A`, `B`, `None`|
|Tv|辺がvのどこに繋がるか|`A`, `B`, `None`|

### 変換手順
1. 各頂点に対して適当に番号を付け、適当にABを定める。
2. 結び目の向きを定める。
3. 頂点同士を結ぶある一辺を選ぶ
4. 3.で選んだ辺から、ひもをなぞっていく。(かならず一筆書きできる)

まず1.の頂点を偶奇を持たせて追加する(空頂点の偶奇は`None`)。次に、4.によって判明した辺を`(始点, 終点, 始点のABどちらからでているか, 終点のABどちらに入っているか)`として追加していく。(空頂点から出る/空頂点に入る箇所の`Tu`, `Tv`は`None`)

これによって出来たグラフを以下のようなファイル形式(`knot graph`の略で`.kng`とした)で表すこととする

```
[nodes]
頂点番号 偶奇

[euler circuit]
始点1 終点1 始点1のどちらから出ているか 終点1のどちらへ入っているか
始点2 終点2 始点2のどちらから出ているか 終点2のどちらへ入っているか
```

例えば以下のようになる
```
[nodes]
0 None
1 Odd
2 None

[euler circuit]
0 1 None A
1 2 B None
2 1 None B
1 0 A None
```

結び目を`kng`形式に整理し、`kng`形式のファイルをグラフオブジェクトに変換することで、結び目→グラフの変換とする

### 実装
[convert.py](../graphs/convert.py)

## 4. グラフ→結び目
結び目グラフを結び目に復元する(=オイラー閉路を見つける)手法について書く。

この時、結び目Kiを変換した結び目グラフGiが存在するとして、Giを復元するとKiになるように定義する。


### アルゴリズム
1. 適当に辺(u, v, Tu, Tv)を一つ選ぶ
2. 自分の位置をvに更新する
3. vの偶奇とTvから、次の辺がABどちらから出るか判定する
4. 選んだ辺を消す
5. vから出ている辺のうち、3の条件を満たす辺(u, v, Tu, Tv)を選ぶ。選べない場合、それ以前に二股になっている部分があるため、そこまで戻り、選んでいない方の辺を選ぶ。
6. 2に戻る


### 実装
[algorithms.py](../graphs/algorithms.py)


## 5. 同一性の判定
もともとの結び目Kiが持っているオイラー閉路と、Kiを変換して得られたGiから得られたオイラー閉路が同一なら、KiとGiが相互に変換できていると判断する。すなわち、オイラー閉路を結び目の完全な不変量として考える。(これが正しいかは後に確かめる)

オイラー閉路ec1とec2があるとき、任意の辺を最初にすることでec1=ec2となるとき、ec1とec2が同一であるとする。

### 実装
[test_algorithms.py](../graphs/test_algorithms.py)

### 実行結果
step0~step3までは全て復元できた。

## 6. 資料
+ [結び目理論 - Wikipedia](https://ja.m.wikipedia.org/wiki/%E7%B5%90%E3%81%B3%E7%9B%AE%E7%90%86%E8%AB%96)
+ [競プロにおけるオイラー路とその応用について - Learning Algorithms](https://kokiymgch.hatenablog.com/entry/2017/12/07/193238)
+ [グラフ理論とNetworkX - PyQ](https://docs.pyq.jp/python/math_opt/graph.html)
+ [【Python】NetworkX 2.0の基礎的な使い方まとめ - Qiita](https://qiita.com/kzm4269/items/081ff2fdb8a6b0a6112f)